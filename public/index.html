<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Communication Health Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5rem;
            border-bottom: 2px solid #4facfe;
            padding-bottom: 5px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4facfe;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
            font-family: 'Courier New', monospace;
        }

        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .response-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }

        .response-section.show {
            display: block;
        }

        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }

        .error {
            color: #ff6b6b;
            background: #ffe6e6;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ffcdd2;
        }

        .success {
            color: #2e7d32;
            background: #e8f5e8;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #c8e6c9;
        }

        .sample-data {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .sample-data h3 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .sample-controls {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 25px;
            align-items: start;
        }

        .sample-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .sample-group label {
            font-weight: 600;
            color: #856404;
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .scenario-select {
            padding: 12px;
            border: 2px solid #ffeaa7;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            color: #333;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .scenario-select:focus {
            outline: none;
            border-color: #f39c12;
        }

        .scenario-select option {
            padding: 8px;
        }

        @media (max-width: 968px) {
            .sample-controls {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .json-format {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            display: none;
        }

        .json-format.show {
            display: block;
        }

        .json-format pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
            margin-top: 10px;
        }

    .dashboard {
        margin-top: 20px;
        display: none;
    }

    .dashboard.show {
        display: block;
    }

    .health-overview {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 20px;
        text-align: center;
    }

    .health-score {
        font-size: 3rem;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .health-status {
        font-size: 1.5rem;
        opacity: 0.9;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .metric-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border-top: 4px solid #4facfe;
    }

    .metric-card h3 {
        color: #333;
        margin-bottom: 15px;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .metric-score {
        font-size: 2.5rem;
        font-weight: bold;
        color: #4facfe;
        margin-bottom: 10px;
    }

    .metric-label {
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 10px;
    }

    .progress-bar {
        background: #e1e5e9;
        border-radius: 10px;
        height: 8px;
        margin-top: 10px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        border-radius: 10px;
        transition: width 0.8s ease;
    }

    .insights-section {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }

    .insights-section h3 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.3rem;
        border-bottom: 2px solid #4facfe;
        padding-bottom: 8px;
    }

    .insight-item {
        margin-bottom: 15px;
        padding: 12px;
        border-radius: 6px;
        border-left: 4px solid #4facfe;
    }

    .insight-strength {
        background: #e8f5e8;
        border-left-color: #4caf50;
    }

    .insight-concern {
        background: #fff3e0;
        border-left-color: #ff9800;
    }

    .insight-recommendation {
        background: #f3e5f5;
        border-left-color: #9c27b0;
    }

    .alert-section {
        margin-bottom: 20px;
    }

    .alert-item {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
        display: flex;
        align-items: start;
        gap: 12px;
    }

    .alert-critical {
        background: #ffebee;
        border-left: 4px solid #f44336;
        color: #c62828;
    }

    .alert-medium {
        background: #fff3e0;
        border-left: 4px solid #ff9800;
        color: #e65100;
    }

    .alert-low {
        background: #e8f5e8;
        border-left: 4px solid #4caf50;
        color: #2e7d32;
    }

    .participants-section {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }

    .participant-list {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 15px;
    }

    .participant-tag {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .json-toggle-section {
        text-align: center;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #eee;
    }

    .json-toggle-section h4 {
        text-align: left;
        margin-bottom: 10px;
        color: #333;
    }

    .raw-json {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
        display: none;
    }

    .raw-json.show {
        display: block;
    }

    .raw-json pre {
        background: #2d3748;
        color: #e2e8f0;
        padding: 20px;
        border-radius: 6px;
        overflow-x: auto;
        font-size: 12px;
        line-height: 1.4;
        max-height: 400px;
        overflow-y: auto;
        text-align: left;
        white-space: pre;
        font-family: 'Courier New', Monaco, Consolas, monospace;
    }

    @media (max-width: 768px) {
        .header h1 {
            font-size: 2rem;
        }
        
        .main-content {
            padding: 20px;
        }

        .metrics-grid {
            grid-template-columns: 1fr;
        }

        .health-score {
            font-size: 2.5rem;
        }
    }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìß Communication Health Analyzer</h1>
            <p>LangGraph-powered email thread analysis for relationship insights</p>
        </div>

        <div class="main-content">
            <div class="sample-data">
                <h3>üöÄ Quick Start</h3>
                <p>Choose from different communication scenarios to test the analyzer with realistic data.</p>
                
                <div class="sample-controls">
                    <div class="sample-group">
                        <label for="emailScenario">üìß Email Scenarios:</label>
                        <select id="emailScenario" class="scenario-select">
                            <option value="">Select email scenario...</option>
                            <option value="good">‚úÖ Good - Professional & Positive</option>
                            <option value="medium">‚ö†Ô∏è Medium - Some Tensions</option>
                            <option value="bad">‚ùå Bad - Conflict & Issues</option>
                        </select>
                        <button class="btn btn-success" onclick="loadEmailScenario()">Load Email Thread</button>
                    </div>
                    
                    <div class="sample-group">
                        <label for="meetingScenario">üé§ Meeting Scenarios:</label>
                        <select id="meetingScenario" class="scenario-select">
                            <option value="">Select meeting scenario...</option>
                            <option value="good">‚úÖ Good - Collaborative Discussion</option>
                            <option value="medium">‚ö†Ô∏è Medium - Mixed Dynamics</option>
                            <option value="bad">‚ùå Bad - Heated Disagreement</option>
                        </select>
                        <button class="btn btn-success" onclick="loadMeetingScenario()">Load Meeting Transcript</button>
                    </div>
                    
                    <div class="sample-group">
                        <button class="btn" onclick="showJsonFormat()">üìã Show JSON Format</button>
                    </div>
                </div>
            </div>

            <div id="jsonFormatSection" class="json-format">
                <h4>üìã Supported JSON Formats:</h4>
                
                <h5>üìß Email Thread Format:</h5>
                <pre>{
  "conversationId": "conv-emails-001",
  "type": "email",
  "participants": ["alice@company.com", "bob@company.com"],
  "emails": [
    {
      "id": "email-001",
      "from": "alice@company.com",
      "to": ["bob@company.com"],
      "cc": [],
      "subject": "Project Update",
      "body": "Hi Bob, I wanted to update you...",
      "timestamp": "2024-01-15T09:00:00.000Z",
      "priority": "normal",
      "isReply": false,
      "replyToId": null
    }
  ],
  "metadata": {
    "source": "outlook",
    "extractedAt": "2024-01-16T10:00:00.000Z",
    "version": "1.0"
  }
}</pre>
                
                <h5>üé§ Meeting Transcript Format:</h5>
                <pre>{
  "conversationId": "meeting-001",
  "type": "meeting",
  "participants": ["Alice Johnson", "Bob Smith", "Carol Davis"],
  "transcript": [
    {
      "id": "transcript-001",
      "speaker": "Alice Johnson",
      "text": "Good morning everyone. Let's discuss the project timeline...",
      "timestamp": "2024-01-15T09:00:00.000Z",
      "duration": 15
    }
  ],
  "metadata": {
    "source": "teams",
    "meetingDuration": 3600,
    "meetingDate": "2024-01-15T09:00:00.000Z",
    "version": "1.0"
  }
}</pre>
            </div>

            <form id="emailForm">
                <div class="form-section">
                    <h2>üí¨ Communication Data (JSON Format)</h2>
                    <div class="form-group">
                        <label for="jsonInput">Paste your conversation JSON here (emails or meeting transcript):</label>
                        <textarea id="jsonInput" name="jsonInput" placeholder='Paste your JSON here...' style="min-height: 400px; font-family: monospace;"></textarea>
                        <small style="color: #666; margin-top: 5px; display: block;">
                            üí° Tip: Supports email threads from Outlook/Gmail or meeting transcripts from Teams/Zoom. Use the "Show JSON Format" button above to see expected formats.
                        </small>
                    </div>
                </div>

                <div class="form-section">
                    <button type="submit" class="btn btn-success">üîç Analyze Communication Health</button>
                    <button type="button" class="btn" onclick="clearForm()">Clear JSON</button>
                    <button type="button" class="btn btn-warning" onclick="validateJson()">‚úÖ Validate JSON</button>
                </div>
            </form>

            <div id="responseSection" class="response-section">
                <h2>Analysis Results</h2>
                <div id="responseContent"></div>
            </div>
        </div>
    </div>

    <script>
        function showJsonFormat() {
            const formatSection = document.getElementById('jsonFormatSection');
            formatSection.classList.toggle('show');
        }

        function clearForm() {
            document.getElementById('jsonInput').value = '';
            document.getElementById('responseSection').classList.remove('show');
            document.getElementById('jsonFormatSection').classList.remove('show');
        }

        function validateJson() {
            const jsonInput = document.getElementById('jsonInput').value.trim();
            const responseSection = document.getElementById('responseSection');
            const responseContent = document.getElementById('responseContent');
            
            if (!jsonInput) {
                responseSection.classList.add('show');
                responseContent.innerHTML = '<div class="error">‚ùå Please enter some JSON to validate.</div>';
                return;
            }

            try {
                const parsed = JSON.parse(jsonInput);
                
                // Basic validation
                const requiredFields = ['conversationId', 'type', 'participants'];
                const missingFields = requiredFields.filter(field => !parsed[field]);
                
                if (missingFields.length > 0) {
                    throw new Error(`Missing required fields: ${missingFields.join(', ')}`);
                }

                if (!['email', 'meeting', 'mixed'].includes(parsed.type)) {
                    throw new Error('type must be "email", "meeting", or "mixed"');
                }

                let contentInfo = '';
                if (parsed.type === 'email' || parsed.type === 'mixed') {
                    if (!Array.isArray(parsed.emails) || parsed.emails.length === 0) {
                        throw new Error('emails must be a non-empty array for email type');
                    }
                    contentInfo += `<p><strong>Number of Emails:</strong> ${parsed.emails.length}</p>`;
                }
                
                if (parsed.type === 'meeting' || parsed.type === 'mixed') {
                    if (!Array.isArray(parsed.transcript) || parsed.transcript.length === 0) {
                        throw new Error('transcript must be a non-empty array for meeting type');
                    }
                    contentInfo += `<p><strong>Transcript Entries:</strong> ${parsed.transcript.length}</p>`;
                }

                responseSection.classList.add('show');
                responseContent.innerHTML = `
                    <div class="success">
                        <h3>‚úÖ JSON is Valid!</h3>
                        <p><strong>Conversation ID:</strong> ${parsed.conversationId}</p>
                        <p><strong>Type:</strong> ${parsed.type}</p>
                        <p><strong>Participants:</strong> ${parsed.participants.join(', ')}</p>
                        ${contentInfo}
                        <p>Ready for analysis!</p>
                    </div>
                `;
            } catch (error) {
                responseSection.classList.add('show');
                responseContent.innerHTML = `
                    <div class="error">
                        <h3>‚ùå JSON Validation Error</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p>Please check your JSON format and try again.</p>
                    </div>
                `;
            }
        }

        // Sample data scenarios
        function getEmailScenarios() {
            return {
                good: {
                    "conversationId": "email-good-001",
                    "type": "email",
                    "participants": ["sarah@company.com", "mike@company.com", "jen@company.com"],
                    "emails": [
                        {
                            "id": "email-001",
                            "from": "sarah@company.com",
                            "to": ["mike@company.com", "jen@company.com"],
                            "cc": [],
                            "subject": "Project Alpha - Great Progress Update! üéâ",
                            "body": "Hi team! I'm thrilled to share that we've completed the initial phase ahead of schedule. The client feedback has been overwhelmingly positive. Thank you all for your excellent work and collaboration. Let's discuss next steps in tomorrow's standup.",
                            "timestamp": "2024-01-15T09:00:00.000Z",
                            "priority": "normal",
                            "isReply": false,
                            "replyToId": null
                        },
                        {
                            "id": "email-002",
                            "from": "mike@company.com",
                            "to": ["sarah@company.com", "jen@company.com"],
                            "cc": [],
                            "subject": "RE: Project Alpha - Great Progress Update! üéâ",
                            "body": "That's fantastic news, Sarah! The team chemistry has been amazing on this project. I'm excited about the next phase. Jen, your UI designs really made the difference. Looking forward to tomorrow's meeting!",
                            "timestamp": "2024-01-15T11:15:00.000Z",
                            "priority": "normal",
                            "isReply": true,
                            "replyToId": "email-001"
                        },
                        {
                            "id": "email-003",
                            "from": "jen@company.com",
                            "to": ["sarah@company.com", "mike@company.com"],
                            "cc": [],
                            "subject": "RE: Project Alpha - Great Progress Update! üéâ",
                            "body": "Thanks Mike! I appreciate the recognition. Sarah, your project management has been stellar - keeping us all aligned and motivated. I have some ideas for phase 2 that I think you'll both love. Can't wait to share tomorrow!",
                            "timestamp": "2024-01-15T13:45:00.000Z",
                            "priority": "normal",
                            "isReply": true,
                            "replyToId": "email-002"
                        }
                    ],
                    "metadata": {
                        "source": "outlook",
                        "extractedAt": "2024-01-16T10:00:00.000Z",
                        "version": "1.0"
                    }
                },
                medium: {
                    "conversationId": "email-medium-001",
                    "type": "email",
                    "participants": ["alex@company.com", "jordan@company.com"],
                    "emails": [
                        {
                            "id": "email-001",
                            "from": "alex@company.com",
                            "to": ["jordan@company.com"],
                            "cc": [],
                            "subject": "Budget Concerns - Need Discussion",
                            "body": "Hi Jordan, I've been reviewing the quarterly budget and I'm concerned about some of the spending in your department. We're 15% over budget and I need to understand what's driving these costs.",
                            "timestamp": "2024-01-15T09:00:00.000Z",
                            "priority": "high",
                            "isReply": false,
                            "replyToId": null
                        },
                        {
                            "id": "email-002",
                            "from": "jordan@company.com",
                            "to": ["alex@company.com"],
                            "cc": [],
                            "subject": "RE: Budget Concerns - Need Discussion",
                            "body": "Alex, I understand your concern. The overspend is due to the emergency server upgrades that were necessary after the security incident last month. I sent a memo about this but maybe it got lost. These were critical infrastructure investments.",
                            "timestamp": "2024-01-15T14:30:00.000Z",
                            "priority": "normal",
                            "isReply": true,
                            "replyToId": "email-001"
                        },
                        {
                            "id": "email-003",
                            "from": "alex@company.com",
                            "to": ["jordan@company.com"],
                            "cc": [],
                            "subject": "RE: Budget Concerns - Need Discussion",
                            "body": "I don't recall receiving that memo, Jordan. Going forward, please ensure all major expenditures are approved through the proper channels. We need better communication to avoid these surprises. Can we set up a meeting to review the process?",
                            "timestamp": "2024-01-15T16:45:00.000Z",
                            "priority": "high",
                            "isReply": true,
                            "replyToId": "email-002"
                        }
                    ],
                    "metadata": {
                        "source": "outlook",
                        "extractedAt": "2024-01-16T10:00:00.000Z",
                        "version": "1.0"
                    }
                },
                bad: {
                    "conversationId": "email-bad-001",
                    "type": "email",
                    "participants": ["david@company.com", "lisa@company.com"],
                    "emails": [
                        {
                            "id": "email-001",
                            "from": "david@company.com",
                            "to": ["lisa@company.com"],
                            "cc": [],
                            "subject": "URGENT: Missed Deadline - This is Unacceptable",
                            "body": "Lisa, I am extremely disappointed that your team missed another critical deadline. This is the third time this quarter. Your lack of planning and execution is putting our entire department at risk. I expect an immediate explanation and action plan.",
                            "timestamp": "2024-01-15T08:30:00.000Z",
                            "priority": "urgent",
                            "isReply": false,
                            "replyToId": null
                        },
                        {
                            "id": "email-002",
                            "from": "lisa@company.com",
                            "to": ["david@company.com"],
                            "cc": [],
                            "subject": "RE: URGENT: Missed Deadline - This is Unacceptable",
                            "body": "David, your tone is completely unprofessional. My team has been working 60+ hour weeks with inadequate resources. Instead of attacking us, maybe you should look at the unrealistic expectations you keep setting. We need support, not blame.",
                            "timestamp": "2024-01-15T10:15:00.000Z",
                            "priority": "urgent",
                            "isReply": true,
                            "replyToId": "email-001"
                        },
                        {
                            "id": "email-003",
                            "from": "david@company.com",
                            "to": ["lisa@company.com"],
                            "cc": [],
                            "subject": "RE: URGENT: Missed Deadline - This is Unacceptable",
                            "body": "Don't talk to me about unprofessional behavior when you can't even manage your own team properly. Everyone else meets their deadlines with the same resources. This is clearly a management issue. I'm escalating this to HR.",
                            "timestamp": "2024-01-15T11:00:00.000Z",
                            "priority": "urgent",
                            "isReply": true,
                            "replyToId": "email-002"
                        }
                    ],
                    "metadata": {
                        "source": "outlook",
                        "extractedAt": "2024-01-16T10:00:00.000Z",
                        "version": "1.0"
                    }
                }
            };
        }

        function getMeetingScenarios() {
            return {
                good: {
                    "conversationId": "meeting-good-001",
                    "type": "meeting",
                    "participants": ["Emma Chen", "Carlos Rodriguez", "Maya Patel"],
                    "transcript": [
                        {
                            "id": "transcript-001",
                            "speaker": "Emma Chen",
                            "text": "Good morning everyone! I'm excited to discuss our Q1 strategy. I've reviewed both of your proposals and they're excellent. Carlos, your market analysis is spot-on, and Maya, your technical roadmap aligns perfectly with our goals.",
                            "timestamp": "2024-01-15T09:00:00.000Z",
                            "duration": 18
                        },
                        {
                            "id": "transcript-002",
                            "speaker": "Carlos Rodriguez",
                            "text": "Thanks Emma! I really appreciate Maya's input on the technical feasibility. Her feedback helped me refine the market entry strategy. I think we have a solid foundation for success.",
                            "timestamp": "2024-01-15T09:00:20.000Z",
                            "duration": 12
                        },
                        {
                            "id": "transcript-003",
                            "speaker": "Maya Patel",
                            "text": "This collaboration has been fantastic. Carlos's market insights really opened my eyes to some technical priorities I hadn't considered. Emma, your leadership in bringing us together has been invaluable. I'm confident we can exceed our targets.",
                            "timestamp": "2024-01-15T09:00:35.000Z",
                            "duration": 16
                        },
                        {
                            "id": "transcript-004",
                            "speaker": "Emma Chen",
                            "text": "I love the positive energy here! Let's build on this momentum. What do we need from each other to make Q1 a huge success? Let's be specific about how we can support one another.",
                            "timestamp": "2024-01-15T09:00:55.000Z",
                            "duration": 14
                        }
                    ],
                    "metadata": {
                        "source": "teams",
                        "meetingDuration": 1800,
                        "meetingDate": "2024-01-15T09:00:00.000Z",
                        "extractedAt": "2024-01-15T10:30:00.000Z",
                        "version": "1.0"
                    }
                },
                medium: {
                    "conversationId": "meeting-medium-001",
                    "type": "meeting",
                    "participants": ["Robert Kim", "Amanda Jones", "Tyler Brown"],
                    "transcript": [
                        {
                            "id": "transcript-001",
                            "speaker": "Robert Kim",
                            "text": "Let's get started. We need to address the delays in the product launch. Amanda, can you explain what's causing the holdups in marketing?",
                            "timestamp": "2024-01-15T09:00:00.000Z",
                            "duration": 10
                        },
                        {
                            "id": "transcript-002",
                            "speaker": "Amanda Jones",
                            "text": "Robert, the delays aren't just on marketing's side. We've been waiting for final product specs from Tyler's team for two weeks. How can we finalize campaigns without knowing the final features?",
                            "timestamp": "2024-01-15T09:00:12.000Z",
                            "duration": 12
                        },
                        {
                            "id": "transcript-003",
                            "speaker": "Tyler Brown",
                            "text": "That's fair, Amanda, but we've been dealing with some technical challenges that weren't anticipated. These features are complex. I'd rather deliver something solid than rush and create problems later.",
                            "timestamp": "2024-01-15T09:00:26.000Z",
                            "duration": 14
                        },
                        {
                            "id": "transcript-004",
                            "speaker": "Robert Kim",
                            "text": "I understand both perspectives. Tyler, can you give us a realistic timeline? Amanda, what's the minimum lead time you need once we have final specs? Let's work backward from our launch date.",
                            "timestamp": "2024-01-15T09:00:42.000Z",
                            "duration": 15
                        },
                        {
                            "id": "transcript-005",
                            "speaker": "Amanda Jones",
                            "text": "I need at least three weeks for a proper campaign rollout. Less than that and we're risking a poor market introduction.",
                            "timestamp": "2024-01-15T09:01:00.000Z",
                            "duration": 8
                        }
                    ],
                    "metadata": {
                        "source": "teams",
                        "meetingDuration": 2400,
                        "meetingDate": "2024-01-15T09:00:00.000Z",
                        "extractedAt": "2024-01-15T11:30:00.000Z",
                        "version": "1.0"
                    }
                },
                bad: {
                    "conversationId": "meeting-bad-001",
                    "type": "meeting",
                    "participants": ["Mark Sullivan", "Jessica Wong", "Brian Clarke"],
                    "transcript": [
                        {
                            "id": "transcript-001",
                            "speaker": "Mark Sullivan",
                            "text": "I called this meeting because I'm tired of the constant finger-pointing and excuses. Jessica, your team's performance has been subpar, and Brian, your lack of communication is making everything worse.",
                            "timestamp": "2024-01-15T09:00:00.000Z",
                            "duration": 16
                        },
                        {
                            "id": "transcript-002",
                            "speaker": "Jessica Wong",
                            "text": "Excuse me? My team has been working with impossible deadlines and zero support from Brian's infrastructure team. Maybe if we had proper resources instead of these accusations, we could deliver better results.",
                            "timestamp": "2024-01-15T09:00:18.000Z",
                            "duration": 14
                        },
                        {
                            "id": "transcript-003",
                            "speaker": "Brian Clarke",
                            "text": "This is ridiculous. My team has been firefighting issues caused by Jessica's poor requirements gathering. We can't build infrastructure on shifting requirements. And Mark, your unrealistic timelines aren't helping anyone.",
                            "timestamp": "2024-01-15T09:00:35.000Z",
                            "duration": 16
                        },
                        {
                            "id": "transcript-004",
                            "speaker": "Mark Sullivan",
                            "text": "I don't want to hear excuses. The client is threatening to pull the contract because of these delays. Someone needs to take responsibility here. This blame game needs to stop.",
                            "timestamp": "2024-01-15T09:00:55.000Z",
                            "duration": 12
                        },
                        {
                            "id": "transcript-005",
                            "speaker": "Jessica Wong",
                            "text": "Mark, threatening people isn't leadership. If you spent half as much time understanding the actual issues instead of just yelling, maybe we could solve this. This meeting is pointless.",
                            "timestamp": "2024-01-15T09:01:10.000Z",
                            "duration": 13
                        }
                    ],
                    "metadata": {
                        "source": "teams",
                        "meetingDuration": 1200,
                        "meetingDate": "2024-01-15T09:00:00.000Z",
                        "extractedAt": "2024-01-15T10:15:00.000Z",
                        "version": "1.0"
                    }
                }
            };
        }

        function loadEmailScenario() {
            const scenario = document.getElementById('emailScenario').value;
            if (!scenario) {
                alert('Please select an email scenario first!');
                return;
            }
            
            const scenarios = getEmailScenarios();
            const selectedScenario = scenarios[scenario];
            
            document.getElementById('jsonInput').value = JSON.stringify(selectedScenario, null, 2);
            document.getElementById('responseSection').classList.remove('show');
            
            // Reset the dropdown
            document.getElementById('emailScenario').value = '';
        }

        function loadMeetingScenario() {
            const scenario = document.getElementById('meetingScenario').value;
            if (!scenario) {
                alert('Please select a meeting scenario first!');
                return;
            }
            
            const scenarios = getMeetingScenarios();
            const selectedScenario = scenarios[scenario];
            
            document.getElementById('jsonInput').value = JSON.stringify(selectedScenario, null, 2);
            document.getElementById('responseSection').classList.remove('show');
            
            // Reset the dropdown
            document.getElementById('meetingScenario').value = '';
        }

        // Form submission
        document.getElementById('emailForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const jsonInput = document.getElementById('jsonInput').value.trim();
            const responseSection = document.getElementById('responseSection');
            const responseContent = document.getElementById('responseContent');
            
            if (!jsonInput) {
                responseSection.classList.add('show');
                responseContent.innerHTML = '<div class="error">‚ùå Please enter JSON data to analyze.</div>';
                return;
            }
            
            // Show loading
            responseSection.classList.add('show');
            responseContent.innerHTML = '<div class="loading">üîÑ Analyzing communication health...</div>';
            
            try {
                // Parse and validate JSON
                const emailData = JSON.parse(jsonInput);
                
                console.log('Sending email data:', emailData);
                
                // Send to server
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(emailData)
                });
                
                const result = await response.json();
                
                if (result.success && result.data.healthReport) {
                    renderHealthDashboard(result.data.healthReport, result.data);
                } else if (result.success) {
                    // Fallback for when analysis is processing
                    let contentSummary = '';
                    if (result.data.emailCount > 0) {
                        contentSummary += `<p><strong>Emails Analyzed:</strong> ${result.data.emailCount}</p>`;
                    }
                    if (result.data.transcriptCount > 0) {
                        contentSummary += `<p><strong>Transcript Entries:</strong> ${result.data.transcriptCount}</p>`;
                    }
                    
                    responseContent.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ Analysis Request Processed</h3>
                            <p><strong>Message:</strong> ${result.data.message}</p>
                            <p><strong>Conversation ID:</strong> ${result.data.conversationId}</p>
                            <p><strong>Type:</strong> ${result.data.type}</p>
                            ${contentSummary}
                            <p><strong>Total Participants:</strong> ${result.data.totalParticipants}</p>
                            <p><strong>Processed At:</strong> ${new Date(result.data.processedAt).toLocaleString()}</p>
                            <p><em>Check the console in your browser developer tools and the server console for detailed logs.</em></p>
                        </div>
                    `;
                } else {
                    responseContent.innerHTML = `
                        <div class="error">
                            <h3>‚ùå Analysis Failed</h3>
                            <p><strong>Error:</strong> ${result.error}</p>
                            <p><strong>Details:</strong> ${result.details || 'No additional details'}</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Error:', error);
                if (error instanceof SyntaxError) {
                    responseContent.innerHTML = `
                        <div class="error">
                            <h3>‚ùå JSON Parse Error</h3>
                            <p>Invalid JSON format. Please check your JSON and try again.</p>
                            <p><strong>Error:</strong> ${error.message}</p>
                        </div>
                    `;
                } else {
                    responseContent.innerHTML = `
                        <div class="error">
                            <h3>‚ùå Network Error</h3>
                            <p>Failed to connect to the analysis server. Please check that the server is running.</p>
                            <p><strong>Error:</strong> ${error.message}</p>
                        </div>
                    `;
                }
            }
        });

        // Dashboard rendering functions
        function renderHealthDashboard(healthReport, analysisData) {
            const responseContent = document.getElementById('responseContent');
            
            // Generate dashboard HTML
            responseContent.innerHTML = `
                <div class="dashboard show">
                    ${renderHealthOverview(healthReport)}
                    ${renderMetricsGrid(healthReport)}
                    ${renderParticipantsSection(healthReport)}
                    ${renderAlertsSection(healthReport)}
                    ${renderInsightsSection(healthReport)}
                    ${renderJsonToggleSection(healthReport)}
                </div>
            `;
        }

        function renderHealthOverview(healthReport) {
            const statusEmoji = {
                'excellent': 'üü¢',
                'good': 'üü°',
                'moderate': 'üü†',
                'at-risk': 'üî¥',
                'critical': 'üö®'
            };

            return `
                <div class="health-overview">
                    <div class="health-score">${healthReport.overallScore}/100</div>
                    <div class="health-status">${statusEmoji[healthReport.status]} ${healthReport.status}</div>
                    <p style="margin-top: 15px; opacity: 0.9;">${healthReport.summary}</p>
                </div>
            `;
        }

        function renderMetricsGrid(healthReport) {
            const breakdown = healthReport.breakdown;
            const isEmail = healthReport.type === 'email' || healthReport.type === 'mixed';
            
            let metricsCards = `
                ${renderMetricCard('üíù Emotional Health', breakdown.emotionalHealth.score, '#e91e63')}
            `;
            
            // Only show responsiveness for email communications
            if (isEmail && breakdown.responsivenessHealth.weight > 0) {
                metricsCards += renderMetricCard('‚ö° Responsiveness', breakdown.responsivenessHealth.score, '#2196f3');
            }
            
            metricsCards += `
                ${renderMetricCard('‚öñÔ∏è Conflict Management', breakdown.conflictHealth.score, '#ff9800')}
                ${renderMetricCard('ü§ù Relationship Health', breakdown.relationshipHealth.score, '#4caf50')}
            `;
            
            // Adjust grid columns based on number of metrics
            const gridColumns = isEmail && breakdown.responsivenessHealth.weight > 0 ? 'repeat(auto-fit, minmax(250px, 1fr))' : 'repeat(auto-fit, minmax(280px, 1fr))';
            
            return `
                <div class="metrics-grid" style="grid-template-columns: ${gridColumns};">
                    ${metricsCards}
                </div>
            `;
        }

        function renderMetricCard(title, score, color) {
            const progressColor = score >= 70 ? '#4caf50' : score >= 50 ? '#ff9800' : '#f44336';
            
            return `
                <div class="metric-card">
                    <h3>${title}</h3>
                    <div class="metric-score" style="color: ${color};">${score}</div>
                    <div class="metric-label">Score out of 100</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${score}%; background-color: ${progressColor};"></div>
                    </div>
                </div>
            `;
        }

        function renderParticipantsSection(healthReport) {
            const participantTags = healthReport.participants.map(p =>
                `<span class="participant-tag">${p}</span>`
            ).join('');
            
            return `
                <div class="participants-section">
                    <h3>üë• Participants (${healthReport.participants.length})</h3>
                    <div class="participant-list">${participantTags}</div>
                    <p style="margin-top: 15px; color: #666;">
                        <strong>Conversation:</strong> ${healthReport.conversationId} ‚Ä¢
                        <strong>Type:</strong> ${healthReport.type} ‚Ä¢
                        <strong>Analyzed:</strong> ${new Date(healthReport.analysisMetadata.analyzedAt).toLocaleString()}
                    </p>
                </div>
            `;
        }

        function renderAlertsSection(healthReport) {
            if (!healthReport.alerts || healthReport.alerts.length === 0) {
                return '';
            }

            const alertItems = healthReport.alerts.map(alert => {
                const alertClass = `alert-${alert.severity}`;
                const alertEmoji = {
                    'critical': 'üö®',
                    'medium': '‚ö†Ô∏è',
                    'low': '‚ÑπÔ∏è'
                };
                
                return `
                    <div class="alert-item ${alertClass}">
                        <div style="font-size: 1.2rem;">${alertEmoji[alert.severity]}</div>
                        <div>
                            <strong>${alert.message}</strong>
                            <p style="margin-top: 5px;">${alert.recommendation}</p>
                        </div>
                    </div>
                `;
            }).join('');

            return `
                <div class="alert-section">
                    <h3 style="color: #f44336; margin-bottom: 15px;">üö® Alerts</h3>
                    ${alertItems}
                </div>
            `;
        }

        function renderInsightsSection(healthReport) {
            const insights = healthReport.insights;
            
            const strengthItems = insights.strengths.map(strength =>
                `<div class="insight-item insight-strength">‚úÖ ${strength}</div>`
            ).join('');
            
            const concernItems = insights.concerns.map(concern =>
                `<div class="insight-item insight-concern">‚ö†Ô∏è ${concern}</div>`
            ).join('');
            
            const recommendationItems = insights.recommendations.map(rec =>
                `<div class="insight-item insight-recommendation">
                    <strong>${rec.priority.toUpperCase()}:</strong> ${rec.action}
                    <small style="display: block; margin-top: 5px; opacity: 0.7;">${rec.expectedImpact}</small>
                </div>`
            ).join('');

            return `
                <div class="insights-section">
                    <h3>üí° Insights & Recommendations</h3>
                    
                    <h4 style="color: #4caf50; margin: 20px 0 10px 0;">Strengths</h4>
                    ${strengthItems}
                    
                    <h4 style="color: #ff9800; margin: 20px 0 10px 0;">Areas of Concern</h4>
                    ${concernItems}
                    
                    <h4 style="color: #9c27b0; margin: 20px 0 10px 0;">Recommendations</h4>
                    ${recommendationItems}
                </div>
            `;
        }

        function renderJsonToggleSection(healthReport) {
            return `
                <div class="json-toggle-section">
                    <button class="btn btn-secondary" onclick="toggleRawJson()">üìã View Raw JSON</button>
                    <div id="rawJsonSection" class="raw-json">
                        <h4>Raw Analysis Data:</h4>
                        <pre>${JSON.stringify(healthReport, null, 2)}</pre>
                    </div>
                </div>
            `;
        }

        function toggleRawJson() {
            const rawJsonSection = document.getElementById('rawJsonSection');
            rawJsonSection.classList.toggle('show');
        }
    </script>
</body>
</html>